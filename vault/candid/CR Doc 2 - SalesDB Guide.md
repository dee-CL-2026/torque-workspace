# CLDoc 2 --- Candid Labs Sales DB System Guide

## Document Code: CLDoc-02

## Version: v1.0

## Owner: Candid Labs

## Last Updated: 

# 1. Purpose of the Sales DB

The **Candid Sales Database (Sales DB)** is the centralised system for
transforming raw sales-related data into a clean, standardised,
analysis-ready dataset.\
It consolidates:

-   Xero Receivable detail exports (RAW → CLEAN → Revenue Master)

-   Mapping tables for all venues, distributors, and account IDs

-   Automated status tracking for customer health

-   Dormancy detection and account lifecycle insights

-   Inputs for Looker dashboards and monthly reporting

The Sales DB is built to support:

1.  **Accuracy**

2.  **Repeatability** (VA-friendly workflows)

3.  **Scalability** as sales volume increases

4.  **Integration** with Looker, NotebookLM, Monthly Reporting Packs

# 2. High-Level System Flow

Xero Receivable Export (RAW)

│

▼

cleanReceivableDetailRaw()

(CLEAN normalised receivables)

│

▼

rebuildSalesRevenueMasterFromReceivables()

(SALES_REVENUE_MASTER)

│

▼

runConfigToolsRefresh()

(Mapping, validation, constants, enrichment)

│

▼

rebuildAccountStatus()

(checkDormantAccounts)

│

▼

Looker Dashboards & Monthly Reporting

# 3. Sheet Structure

  -----------------------------------------------------------------------
  **Sheet Name**                  **Purpose**
  ------------------------------- ---------------------------------------
  **RECEIVABLE_DETAIL_RAW**       Direct paste from Xero export

  **RECEIVABLE_DETAIL_CLEAN**     Normalised line-level data generated by
                                  script

  **SALES_REVENUE_MASTER**        Final structured revenue table

  **CONFIG_MAPPING**              Venue → Market/City/Channel/Group info

  **CONFIG_CONSTANTS**            Dropdown values, category lists

  **ACCOUNT_TRACKING**            All enriched sales events

  **ACCOUNT_STATUS**              Customer lifecycle/state snapshot

  **DORMANT_ACCOUNTS**            Customers flagged dormant/lost

  **TAB STRUCTURE**               QA sheet generated by utility scripts
  -----------------------------------------------------------------------

# 4. Core Automation Functions

## 4.1 cleanReceivableDetailRaw()

Transforms messy Xero exports into a clean, structured table.

Key operations:

-   Identifies and groups lines under correct customer

-   Parses dates

-   Removes "Total" or junk rows

-   Standardises currency → IDR

-   Removes empty lines

-   Writes final CLEAN table with stable 19-column structure

Output feeds directly into the revenue rebuild.

## 4.2 rebuildSalesRevenueMasterFromReceivables()

Builds final sales revenue master from CLEAN receivables.

Key behaviour:

-   Excludes **draft / voided / deleted**

-   Uses **Invoice_Total_IDR** as source of truth

-   Converts cans → cases (24 per case)

-   Applies customer mapping from CONFIG_MAPPING

-   Creates transaction IDs (YYYYMMDD-####)

-   Outputs standardised 15-column table

This table is the backbone for Looker dashboards.

## 4.3 runConfigToolsRefresh()

Master refresh for mapping and configuration:

-   Syncs mapping from ACCOUNT_TRACKING

-   Static-locks Raw_Value

-   Rebuilds dropdown lists in CONFIG_CONSTANTS

-   Applies data validations

-   Pushes mapping values into ACCOUNT_TRACKING

-   Logs matched/unmatched status

This ensures consistent customer and venue definitions.

## 4.4 rebuildAccountStatus()

Creates a snapshot of account-level engagement.

Produces:

-   First order date

-   Latest order date

-   Days since last order

-   Active / Dormant / Lost classification

Feeds directly into Dormant Accounts table and dashboards.

## 4.5 checkDormantAccounts()

Applies rules to identify:

-   Dormant

-   Lost

-   Inactive

-   Recently reactivated

Outputs clean table in **DORMANT_ACCOUNTS**.

# 5. VA Workflow (One-Click Process)

Using the menu:

**Sales DB Tools → "✨ Run All Sales Tools"**

Behind the scenes this executes:

1.  Clean Receivable RAW

2.  Build Revenue Master

3.  Rebuild mappings & validations

4.  Update Account Tracking

5.  Build Account Status

6.  Check Dormancy

7.  Freeze & protect headers (ignored if protected)

This is the **official VA workflow** for monthly refresh.

# 6. How Data Flows to Looker Dashboards

The following sheets act as the authoritative sources:

  -----------------------------------------------------------------------
  **Looker Widget**     **Source Sheet**
  --------------------- -------------------------------------------------
  Revenue over time     SALES_REVENUE_MASTER

  SKU Mix               SALES_REVENUE_MASTER

  Channel performance   SALES_REVENUE_MASTER + CONFIG_MAPPING

  Venue activity        ACCOUNT_STATUS
  tracking              

  Dormancy              DORMANT_ACCOUNTS

  Case/Cans totals      SALES_REVENUE_MASTER
  -----------------------------------------------------------------------

Looker pulls only **final cleaned tables**, never RAW.

# 7. Known Business Rules

-   **CANS_PER_CASE = 24**

-   Excluded statuses: **draft**, **voided**, **deleted**

-   All currency normalised to **IDR**

-   Customer name must match CONFIG_MAPPING.Raw_Value exactly

-   Mapping keys are static once created

-   SKU names bucketed based on standard logic

# 8. Risks & Controls

  -----------------------------------------------------------------------
  **Risk**                        **Control**
  ------------------------------- ---------------------------------------
  RAW exports pasted incorrectly  CLEAN script validation + header lock

  Mapping errors                  runConfigToolsRefresh() + validation
                                  rules

  Deleted invoices appearing in   EXCLUDED_STATUSES
  revenue                         

  Looker showing inconsistent     SALES_REVENUE_MASTER as single source
  numbers                         

  VA errors during refresh        One-click menu simplifies process
  -----------------------------------------------------------------------

# 9. Appendices

### A. Field Dictionary --- SALES_REVENUE_MASTER

  -----------------------------------------------------------------------
  **Field**                           **Description**
  ----------------------------------- -----------------------------------
  Transaction_ID                      Unique ID per line

  Invoice_Date                        Parsed date

  Invoice_Number                      Xero invoice number

  Distributor_Name                    Customer / Distributor

  Internal_Venue_Name                 From mapping

  Account_ID                          Unique customer code

  SKU_Name                            Product description

  Quantity_Cases                      Cans / 24

  Quantity_Cans                       Raw units

  Invoice_Value_IDR                   Xero line value

  Revenue_IDR                         Revenue (same as invoice total)

  Market / City / Channel / Group     Mapping-based fields
  -----------------------------------------------------------------------

### B. CLEAN Receivable Field Dictionary

A complete 19-column definition aligned with the CLEAN output.

#### End of CLDoc-02
