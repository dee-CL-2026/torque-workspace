# 2026-02-08 ‚Äî Daily Notes

## Major Win: Gemini Subagents Working üéâ

Spent significant time debugging subagent issues with Dee. Key breakthrough:

**Problem:** Subagents failed with "No API provider registered for api: undefined" when trying non-Opus models.

**Root cause:** `agents.defaults.models` in config is an **allowlist**, not just alias definitions. If any models are listed, ONLY those models can be used for subagents.

**Solution:** Add Google models to the allowlist:
```json
"agents": {
  "defaults": {
    "models": {
      "anthropic/claude-opus-4-5": { "alias": "opus" },
      "google/gemini-2.5-flash": {},
      "google/gemini-2.5-pro": {}
    },
    "subagents": {
      "model": "google/gemini-2.5-flash"
    }
  }
}
```

**Result:** Subagents now run on Gemini Flash FREE tier. Zero cost for parallel work.

---

## Session Highlights

### Morning
- Sent first proper morning briefing to Dee
- Fixed HEARTBEAT.md to require actual proactive work
- Removed outdated Sinead passport task (already renewed)

### API Research
- Claude MAX: Only authorizes Opus for API (confirmed)
- ChatGPT Plus: Zero API access
- Gemini Advanced: No API... BUT free tier available (15 RPM, 1M tokens/day)
- Dee provided Gemini API key

### Config Work
- Added Google provider to OpenClaw config
- Added auth profile `google:gemini`
- Updated MEMORY.md with complete setup documentation

### Ack System (In Progress)
- Identified existing: `ackReactionScope: "group-mentions"` in Telegram config
- Options discussed:
  1. Expand ack reactions to include DMs
  2. Add "on it" notices before longer tasks
- Awaiting Dee's preference

---

## Gotchas Documented

1. **agents.defaults.models = allowlist** ‚Äî if it has entries, only listed models work for subagents
2. **Memory search disabled** ‚Äî embeddings not configured, semantic search fails silently
3. **web_search unavailable** ‚Äî no Brave API key configured

---

## Tasks Status

### Completed
- [x] Morning briefing system
- [x] Gemini subagent integration
- [x] MEMORY.md updated with Gemini setup

### Blocked
- Calendar integration (needs interactive auth)
- Email access (needs setup)

### Pending Decision
- Ack system approach (awaiting Dee)

---

*Good progress day. Subagent cost dropped from ~$0.03+ to $0.*

---

## Telegram Export Analysis (Evening Session)

### Export Details
- File: `vault/inbox/telegram-export-Claw_Torque-20260208-132802.txt` (20,068 lines)
- Read ~90% (to line 18127). Remaining ~1,940 lines unread.
- Previous Feb 7 export removed, kept findings.md

### Key Recovery from Export (Feb 7 section)
- **Model switch crash**: Switching to Sonnet via `/model` broke OAuth auth. Dee offline 43 min. Fix: `claude setup-token` ‚Üí `openclaw config` wizard.
- **MAX OAuth = Opus only**: Sonnet, Haiku, Gemini all fail with MAX token. Confirmed limitation.
- **Browser Relay exists**: Chrome extension for browsing user's tabs. Should've surfaced earlier ‚Äî "lead with laziest path first."
- **Bhanu Teja's Mission Control guide** (3.7M views): Complete 10-agent squad architecture on OpenClaw/Clawdbot. Dee copy-pasted full thread.

### Bhanu's Mission Control ‚Äî Key Patterns
- Each agent = separate session with own SOUL.md, memory, cron heartbeat
- Session keys: `agent:main:main`, `agent:product-analyst:main`, etc.
- Staggered heartbeats (2-min offsets) prevent rate limits
- **WORKING.md** ‚Äî "what am I doing right now" file, read FIRST on wake. **We don't have this yet ‚Äî gap.**
- **Daily automated standup** at end of day: ‚úÖ Completed / üîÑ In Progress / üö´ Blocked / üëÄ Needs Review
- Shared coordination via Convex DB (our tasks.md is simpler equivalent)
- Thread subscriptions: interact with task = auto-subscribed to future comments
- **Lesson: "Start smaller ‚Äî get 2-3 solid before adding more"**
- **Lesson: "Cheaper models for routine work"** ‚Äî exactly our Gemini solution
- Agent levels: Intern (needs approval) ‚Üí Specialist (independent) ‚Üí Lead (full autonomy)

### Gaps Identified (Us vs Bhanu)
| Feature | Bhanu | Us |
|---------|-------|----|
| WORKING.md | ‚úÖ | ‚ùå |
| Daily standup | Automated | ‚ùå |
| @mentions delivery | Daemon polling | ‚ùå |
| Activity feed | Real-time | ‚ùå |
| Thread subscriptions | ‚úÖ | ‚ùå |

### Still TODO
- [ ] Read remaining ~1,940 lines of export
- [ ] Create WORKING.md pattern
- [ ] Plan daily standup automation
- [ ] Update command centre dashboard with staff status panel
- [ ] Implement Bhanu's persistent agent model (recurring heartbeats per agent)

---

## Gemini Subagents Fully Working (Afternoon Session)

### Config Recovery After Powerwash
1. Google provider lost in powerwash ‚Äî re-added via config.patch
2. `models.providers.google.models` must be array of objects `{id, name}` not strings
3. Base URL needs `/v1beta`: `https://generativelanguage.googleapis.com/v1beta`
4. First API key (`AIzaSyCgEzmjw1uS6zQU3zZlmyVT1EarZzRisoI`) flagged as leaked by Google (exposed in chat export)
5. New key created: `AIzaSyDE1V8i1yLpbrMoFayHM0kVFeX6hRhBSIc` ‚Äî working

### Stress Test Results
- **Simultaneous spawn of 13 agents**: 5/13 responded, 8 got empty responses (rate limited)
- **Staggered cron (2-min intervals)**: All 13 cron jobs accepted and fired (jobs list empty = all ran + auto-deleted)
- **Lesson**: Must stagger spawns, can't fire 13 simultaneously on free tier

### Heartbeat Model Change ‚Äî PARTIALLY BROKEN
- Config shows `agents.defaults.heartbeat.model: "google/gemini-2.5-flash"`
- But heartbeats STILL hitting Opus billing errors every 15 min
- Theory: heartbeat runs in main session context which forces Opus
- **UNRESOLVED** ‚Äî needs investigation

### Claude MAX Billing Crisis
- Session limit: 100% used (caused crash, Dee had to manually revive)
- Weekly: 76% (resets Tuesday)
- Extra usage: $80.38 of $100 spent, $38.23 balance
- **URGENT**: Need model fallback so Opus billing limits don't kill the whole system
- Proposed: Primary Opus ‚Üí Fallback Gemini Flash
- Manual config via `openclaw config` wizard recommended (I keep breaking things)

### Subscription Optimization Decision
- Dee agreed: Gemini Advanced ($20) and ChatGPT Plus ($20) are droppable
- Both are web-only, no API access
- Gemini API free tier sufficient for subagents/heartbeats
- Potential savings: $140/mo ‚Üí $100/mo

### Key Config State (Current)
```json
{
  "agents.defaults.heartbeat.model": "google/gemini-2.5-flash",
  "agents.defaults.subagents.model": "google/gemini-2.5-flash",
  "models.providers.google.baseUrl": "https://generativelanguage.googleapis.com/v1beta",
  "models.providers.google.apiKey": "AIzaSyDE1V8i1yLpbrMoFayHM0kVFeX6hRhBSIc"
}
```

### Dee's Priorities (stated)
1. Model fallback ‚Äî URGENT, system keeps dying
2. Manual model switching guide (so Dee can adjust without Torque breaking things)
3. Command centre dashboard ‚Äî add staff status panel
4. Bhanu persistent agent model ‚Äî recurring heartbeats per agent
5. NO extra spend ‚Äî work within current budget

---

## Afternoon Session (14:24‚Äì15:48) ‚Äî Major Infrastructure Day

### Stress Test Results
- **First attempt (13 agents): 0/13** ‚Äî all hit Gemini free tier rate limit (20 req/DAY, not RPM as thought)
- First batch also got old leaked API key errors

### Gemini Billing Enabled ‚úÖ
- Dee set up Google Cloud billing with Wise virtual card on Torque OC project
- Budget alert: ¬£5/month with thresholds at 50%/80%/100%
- Paid tier confirmed working ‚Äî rate limits jumped from 20/day to 2000 RPM
- **Second stress test: 13/13 successful** ‚Äî all agents responded in 1-5 seconds, $0.00 cost
- Queuing worked correctly: first 8 concurrent, last 5 queued and executed as slots freed

### OpenAI Provider Added ‚úÖ
- Dee created OpenAI API key (name: "Torque", Default project, All permissions)
- $5 initial credit, auto-recharge to $10 when <$5, $5/month recharge limit
- Key added via `openclaw models auth paste-token --provider openai` (creates `openai:manual` profile)
- Models added to allowlist via config.patch: `openai/gpt-4o`, `openai/gpt-4.1`
- GPT-4o test confirmed working ($0.016 per call)
- **Config lesson**: OpenAI is a BUILT-IN provider ‚Äî no `models.providers` entry needed, just auth + allowlist
- **Config lesson**: `openclaw models auth paste-token --provider openai` is safe (auth only), `openclaw onboard` is dangerous (full wizard, changes default model)

### Three-Engine Architecture
- üß† **Opus** ‚Äî main session (MAX subscription)
- ‚ö° **Gemini Flash** ‚Äî sub-agents & heartbeats (paid tier, pennies)
- ü§ñ **GPT-4o** ‚Äî coding tasks ($5/month cap)

### Brave Search API Enabled ‚úÖ
- Free tier: 2,000 queries/month, 1 req/sec
- Key: `BSAWQWDjfYZwPulBdepvN0GwQBQz7qq`
- Added via `echo 'BRAVE_API_KEY=...' >> ~/.openclaw/.env` + restart (safest method, no wizard)
- Confirmed working ‚Äî found Bhanu's article immediately

### Task Bucket System Built ‚úÖ
- Secretary agent instructions updated with task triage as core responsibility
- Secretary spawned and built infrastructure in 23 seconds:
  - Created `backlog.md` (unprioritized ideas)
  - Created 14 task bucket files in `team/tasks/{agent-id}.md`
  - Routed existing tasks from `tasks.md` to correct buckets
- Task flow: Intake ‚Üí tasks.md (inbox) ‚Üí team/tasks/{agent}.md (buckets) ‚Üí tasks-done.md (archive)
- Secretary role: triage inbox ‚Üí distribute to buckets, archive completed

### Cross-Channel Messaging Limitation Discovered
- Cannot send WA messages from TG-bound session (or vice versa)
- Sub-agents inherit parent session's channel binding
- **Workaround**: Dee messages on WA when WA actions needed
- Task added for analyst to research fix
- Sent summary to Synthetic Bros (Ryan) successfully when instructed via WA

### OpenClaw Copilot Chrome Extension
- Already installed on Dee's Chromebook, needs configuration
- Settings: Gateway ws://127.0.0.1:18789, Relay ws://127.0.0.1:18792/extension
- Allows me to see/interact with Dee's active browser tabs

### Anthropic Usage (from screenshot)
- Current session: 100% (resets in 26 min)
- Weekly: 76% (resets Tue 7:59 AM)
- Extra usage: $100.27/$118 (85%), $18.35 balance
- Resets Mar 1

### Key Config Commands (Safe)
- `openclaw models auth paste-token --provider {name}` ‚Äî add auth only
- `echo 'KEY=value' >> ~/.openclaw/.env` ‚Äî add env var safely
- `openclaw gateway restart` ‚Äî restart without config change
- `gateway config.patch` (from tool) ‚Äî surgical config updates

### Config That Broke Things
- Direct file copy (`cp /tmp/patched.json openclaw.json`) ‚Äî broke gateway, needed restore from backup
- `gateway config.apply` with full JSON ‚Äî kept getting "invalid config" errors
- `openclaw onboard` ‚Äî opens full wizard, risks changing default model

### Backlog Items Added
- Build cost tracker widget for Command Centre
- Build Brave Search usage tracker + CC widget
- Fix cross-channel messaging (TG‚ÜíWA)
